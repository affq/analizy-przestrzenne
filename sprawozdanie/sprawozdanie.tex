\documentclass{article}
\usepackage[polish]{babel}
\usepackage[T1]{fontenc}
\usepackage{float}
\usepackage{subcaption}
\usepackage{caption}
\usepackage[a4paper,margin=1in]{geometry} 
\parindent = 0pt
\usepackage{amsmath}
\usepackage{enumitem}
\usepackage{minted}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{xcolor}
\usepackage[utf8]{inputenc}
\usepackage{array}
\usepackage{booktabs}
\usepackage{tcolorbox}
\tcbuselibrary{minted,breakable,xparse,skins}
\definecolor{bg}{gray}{0.95}
\DeclareTCBListing{mintedbox}{O{}m!O{}}{%
  breakable=true,
  listing engine=minted,
  listing only,
  minted language=#2,
  minted style=manni,
  minted options={%
    linenos,
    gobble=0,
    breaklines=true,
    breakafter=,,
    fontsize=\small,
    numbersep=8pt,
    #1},
  boxsep=0pt,
  left skip=0pt,
  right skip=0pt,
  left=25pt,
  right=0pt,
  top=3pt,
  bottom=3pt,
  leftrule=0pt,
  rightrule=0pt,
  bottomrule=0pt,
  toprule=0pt,  
  colback=bg,
  enhanced,
  sharp corners
  #3}

\title{Projekt 1: Wskazanie optymalnej lokalizacji farmy fotowoltaicznej – analizy wielokryterialne (MCE)}
\author{Adrian Fabisiewicz (328935)}
\begin{document}
\maketitle
\tableofcontents  % Dodanie spisu treści
\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}}
\renewcommand{\labelenumiii}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}}
\renewcommand{\labelenumiv}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}.\arabic{enumiv}}

\newpage
\section{Wybór lokalizacji farmy fotowoltaicznej}

Wybór optymalnej lokalizacji dla farmy fotowoltaicznej jest kluczowym etapem w procesie inwestycyjnym, wymagającym uwzględnienia szeregu czynników środowiskowych, technicznych, ekonomicznych i prawnych. Celem niniejszego sprawozdania jest przedstawienie wielokryterialnej analizy (MCE) mającej na celu wskazanie najlepszej lokalizacji dla farmy fotowoltaicznej, z uwzględnieniem zarówno aspektów teoretycznych, jak i obowiązujących regulacji prawnych. \newline
Przy wyborze lokalizacji farmy fotowoltaicznej należy wziąć pod uwagę między innymi takie czynniki jak:

\begin{enumerate}[label=•]
    \item nasłonecznienie terenu - podstawowy czynnik wpływający na efektywność instalacji 
    \item ukształtowanie terenu - preferowane są tereny płaskie lub o niewielkim nachyleniu w kierunku południowym
    \item powierzchnia i kształt działki; elektrownia fotowoltaiczna to instalacja o mocy od 1 MW - ma montaż elektrowni o takiej mocy potrzeba około 2 ha powierzchni i szerokość minimum 50 m  \footnote{https://hymon.pl/wymogi-jakie-musi-spelniac-dzialka-pod-fotowoltaike/}
    \item odległość od zabudowań mieszkalnych - zalecana minimalna odległość to 500 m ze względu na potencjalne uciążliwości
    \item dostępność dróg dojazdowych - ułatwia transport i logistykę podczas budowy i eksploatacji
    \item odległość od rzek i zbiorników wodnych
    \item pokrycie terenu - preferowane są tereny niezadrzewione i niezacienione
    \item dostępność infrastruktury energetycznej - bliskość sieci elektroenergetycznej średniego napięcia (zalecana odległość do 200 metrów)
    \footnote{https://electrum.pl/jak-wybrac-najlepsza-lokalizacje-do-budowy-farmy-fotowoltaicznej/}
    \item klasa gruntu - preferowane są grunty grunty klasy IV lub niższej, aby nie blokować terenów o wysokiej wartości rolniczej \footnote{https://electrum.pl/jak-zalozyc-farme-fotowoltaiczna-wyjasniamy-etapy/}
\end{enumerate}
\vspace{10pt}

Analiza wielokryterialna pozwala na kompleksową ocenę potencjalnych lokalizacji, uwzględniając wszystkie wymienione czynniki. Metoda ta umożliwia obiektywne porównanie różnych wariantów i wybór optymalnej lokalizacji.
\vspace{10pt}

W kontekście prawnym, kluczowe akty regulujące proces lokalizacji i budowy farm fotowoltaicznych to \footnote{https://www.prawo-budowlane.info/budowa-farmy-fotowoltaicznej-procedury-i-pozwolenia,544,material\_prawo\_budowlane.html}:

\begin{enumerate}[label=•]
    \item Ustawa z dnia 27 marca 2003 r. o planowaniu i zagospodarowaniu przestrzennym
    \item Ustawa z dnia 7 lipca 1994 r. - Prawo budowlane
    \item Ustawa z dnia 20 lutego 2015 r. o odnawialnych źródłach energii
    \item Ustawa z dnia 3 lutego 1995 r. o ochronie gruntów rolnych i leśnych
\end{enumerate}

\section{Cel projektu}

Celem projektu było wskazanie optymalnej lokalizacji nowej farmy fotowoltaicznej dla obszaru gminy Świeradów-Zdrój (powiat lubański, województwo dolnośląskie).

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/swieradow.png}
    \caption{Położenie gminy Świeradów-Zdrój na mapie województwa dolnośląskiego}
\end{figure}
\newpage

\section{Analizowane kryteria}

\begin{table}[h!]
    \centering
    \renewcommand{\arraystretch}{1.4}
    \begin{tabular}{|c|p{4cm}|p{5cm}|p{3.5cm}|}
    \hline
    \textbf{Lp} & \textbf{Kryterium} & \textbf{Parametry} & \textbf{Źródło danych do kryterium} \\ \hline
    1 & odległość od rzek i zbiorników wodnych & jak najbliżej; nieprzekraczalna 100-metrowa strefa ochronna & BDOT10k(SWRS, PTWP)\\ \hline
    2 & odległość od budynków mieszkalnych & jak najdalej, powyżej 150m & BDOT10k(BUBD)\\ \hline
    3 & pokrycie terenu & powyżej 15m od lasu, optymalnie powyżej 100m od lasu & BDOT10k(PTLZ)\\ \hline
    4 & dostęp do dróg utwardzonych & jak największe zagęszczenie & BDOT10k(SKDR)\\ \hline
    5 & nachylenie stoków & jak najbardziej płasko & NMT\\ \hline
    6 & dostęp światła słonecznego & optymalnie: stoki południowe (SW-SE) & NMT\\ \hline
    7 & dobry dojazd od istotnych drogowych węzłów komunikacyjnych & jak najkrótszy czas dojazdu & BDOT10k(SKDR)\\ \hline
    \multicolumn{4}{|c|}{Łączenie kryteriów} \\ \hline
    8 & ocena przydatności terenu (próg przydatności) & \multicolumn{2}{|c|}{80\% / 90\% max. przydatności}\\ \hline
    9 & przydatne działki / grupy działek & min 60\% działki na terenie przydatnym & EGIB \\ \hline
    10 & powierzchnia i min. szerokość obszaru & \multicolumn{2}{|c|}{2ha / 50m}\\ \hline
    11 & koszt przyłącza do sieci SN (mapy kosztów) & jak najniższy & BDOT10k (wszystkie warstwy PT)\\ \hline
    \end{tabular}
    \caption{Tabela z kryteriami lokalizacji}
    \label{tab:kryteria}
    \end{table}
\newpage

\section{Realizacja}
\subsection{Ustalenie środowiska pracy i ścieżek do danych}
Na początku pracy z Pythonem należało zaimportować odpowiednie moduły z biblioteki arcpy oraz zadbać o to, żeby jako interpreter języka Python została wybrana wersja Pythona instalowana razem z oprogramowaniem ArcGIS.
\vspace{5pt}

\begin{mintedbox}{python}
import arcpy.analysis
import arcpy.management
import arcpy.sa
\end{mintedbox}
\vspace{10pt}

Przed rozpoczęciem pracy z danymi należało ustalić odpowiednie parametry środowiska. Ustalono odpowiedni folder odczytu i zapisu danych na geobazę projektu, w której znajdowały się odpowiednie dane. Ustawiono układ współrzędnych na EPSG:2180 oraz rozmiar komórki na 5, zgodny z rozmiarem pobranego przez nas rastra NMT. Zakres oraz maskę projektu dostosowano do powierzchni warstwy, zawierającej ???-metrowy bufor wokół terenu gminy. Ustalono również nadpisywanie warstw w przypadku, jeżeli warstwa o tej samej nazwie już by istniała w folderze.
\vspace{5pt}

\begin{mintedbox}{python}
geobaza = r"C:\Users\adria\Desktop\STUDIA_FOLDERY\analizy\MyProject12\MyProject12.gdb"
arcpy.env.workspace = "in_memory"
arcpy.env.outputCoordinateSystem = arcpy.SpatialReference("ETRS_1989_Poland_CS92")
arcpy.env.extent = f"{geobaza}\\gmina_buffer"
arcpy.env.mask = f"{geobaza}\\gmina_buffer"
arcpy.env.cellSize = 5
arcpy.env.overwriteOutput = True
\end{mintedbox}
\vspace{10pt}

\begin{mintedbox}{python}
linie_elektroenergetyczne = arcpy.management.Merge([f'{geobaza}\\SULN_L_0210', f'{geobaza}\\SULN_L_0212'], 'linie_elektroenergetyczne')
\end{mintedbox}
\vspace{10pt}

\subsection{Kryterium 1: odległość od rzek i zbiorników wodnych}
Jako dane wejściowe do rozpatrzenia kryterium pierwszego wykorzystano obiekty o kodzie OT\_SWRS\_L z bazy BDOT10k, reprezentujące rzeki i strumienie, oraz obiekty o kodzie OT\_PTWP\_A, reprezentujące wody powierzchniowe. 
Wokół obiektów liniowych stworzono centymetrowy bufor, aby zamienić je na obiekty poligonowe i móc połączyć je w jedną klasę z obiektami reprezentującymi wody powierzchniowe. Użyto do tego narzędzi \textit{Buffer} oraz \textit{Merge}.
\vspace{5pt}

\begin{mintedbox}{python}
swrs_0210_buffer = arcpy.analysis.Buffer(f'{geobaza}\\SWRS_L_0210', f'{geobaza}\\SWRS_L_0210_buffer', '1 Centimeter')
swrs_0212_buffer = arcpy.analysis.Buffer(f'{geobaza}\\SWRS_L_0212', f'{geobaza}\\SWRS_L_0212_buffer', '1 Centimeter')
water = arcpy.management.Merge([swrs_0210_buffer, swrs_0212_buffer, f'{geobaza}\\PTWP_A_0210', f'{geobaza}\\PTWP_A_0212'], 'water')
\end{mintedbox}
\vspace{10pt}

Pierwszym krokiem analizy dla tego kryterium było wykonanie mapy odległości od wód z użyciem narzędzia \textit{Distance Accumulation} z zestawu narzędzi \textit{Spatial Analyst}.
\vspace{5pt}

\begin{mintedbox}{python}
water_accumulation = arcpy.sa.DistanceAccumulation(in_source_data=water)
\end{mintedbox}
\vspace{10pt}

Następnie, z użyciem narzędzia \textit{Fuzzy Membership} zbadano członkostwo poszczególnych komórek, wykorzystując do tego utworzony w poprzednim kroku raster.
\vspace{5pt}

\begin{mintedbox}{python}
increasing_water = arcpy.sa.FuzzyMembership(water_accumulation, fuzzy_function="LINEAR 100 102")
decreasing_water = arcpy.sa.FuzzyMembership(water_accumulation, fuzzy_function="LINEAR 1000 500")
\end{mintedbox}
\vspace{5pt}

W pierwszej funkcji, rosnącej:
\begin{enumerate}[label=•]
    \item wartości \( \leq 100 \) otrzymują wartość członkostwa 0 (nie spełniają kryterium)
    \item wartości \( \geq 102 \) otrzymują wartość członkostwa 1 (pełne spełnienie kryterium)
    \item wartości pomiędzy 100 a 102 otrzymują wartość członkostwa proporcjonalnie do ich odległości od 100
\end{enumerate}
\vspace{5pt}

Dla drugiej funkcji, malejącej:
\begin{enumerate}[label=•]
    \item wartości \( \geq 1000 \) otrzymują wartość członkostwa 0 (nie spełniają kryterium)
    \item wartości \( \leq 500 \) otrzymują wartość członkostwa 1 (pełne spełnienie kryterium)
    \item wartości pomiędzy 1000 a 500 otrzymują wartość członkostwa proporcjonalnie do ich odległości od 1000.
\end{enumerate}
\vspace{10pt}

Reklasyfikacji dokonano zgodnie z poniższymi rysunkami.
\vspace{5pt}

\begin{figure}[H]
    \centering
    \begin{minipage}{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/kryterium1-wykres-rosnaca.png}
        \caption{Funkcja rosnąca}
    \end{minipage}
    \begin{minipage}{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/kryterium1-wykres-malejaca.png}
        \caption{Funkcja malejąca}
    \end{minipage}
\end{figure}
\vspace{10pt}

Ostateczny wynik dla kryterium pierwszego uzyskano po połączeniu obu warstw utworzonych wcześniej przy użyciu logiki rozmytej. Wykorzystano do tego narzędzie \textit{FuzzyOverlay}. Raster wynikowy pokazuje obszary, które spełniają oba kryteria jednocześnie, uwzględniając najniższy poziom spełnienia.
\vspace{5pt}

\begin{mintedbox}{python}
water_map = arcpy.sa.FuzzyOverlay([increasing_water, decreasing_water], 'AND')
\end{mintedbox}
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{img/kryterium1-wykres-glowny.png}
    \caption{Reklasyfikacja dla kryterium 1.}
\end{figure}

Przydatność dla kryterium pierwszego pokazuje poniższa mapa. \newline
Tereny przydatne (białe obszary) stanowią około 80.6\% całkowitej powierzchni, co świadczy o dużej dostępności terenów pod inwestycję. Tereny nieprzydatne (czarne obszary) to tylko około 16.2\% powierzchni, co oznacza, że strefa buforowa 150m od wody oraz obszary położone powyżej 1000m od wody zajmują stosunkowo niewielką część analizowanego obszaru. \newline
Większość terenu jest więc dostępna pod inwestycję, a strefy wykluczone układają się w charakterystyczny wzór wzdłuż cieków wodnych.
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/kryterium1-layout.jpg}
    \caption{Mapa przydatności dla kryterium 1.}
    \label{mapa-przydatnosci-1}
\end{figure}
\vspace{10pt}
\newpage

Poniżej zaprezentowano mapę przedstawiającą rzeki i wody powierzchniowe na tle utworzonej mapy przydatności.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/kryterium1-woda.jpg}
    \caption{Rzeki oraz wody powierzchniowe na tle mapy przydatności}
\end{figure}
\vspace{10pt}

\subsection{Kryterium 2: odległość od budynków mieszkalnych}
W celu rozpatrzenia kryterium odległościowego od budynków mieszkalnych, pobrano z bazy BDOT10k poligonową warstwę z obiektami o kodzie OT\_BUBD\_A, reprezentującymi budynki. 
\vspace{5pt}

\begin{mintedbox}{python}
buildings = arcpy.management.Merge([f'{geobaza}\\BUBD_A_0210', f'{geobaza}\\BUBD_A_0212'], 'buildings')
\end{mintedbox}
\vspace{10pt}

Następnie wybrano z nich jedynie te będące budynkami mieszkalnymi. Skorzystano w tym celu z atrybutu \textit{FOBUD}, informującego o funkcji ogólnej budynku. Skonstruowano odpowiednie zapytanie i wybrano zgodne obiekty, korzystając z funkcji \textit{Select}.
\vspace{5pt}

\begin{mintedbox}{python}
arcpy.analysis.Select(buildings, 'residential_buildings', "FOBUD = 'budynki mieszkalne'")
\end{mintedbox}
\vspace{10pt}

Z użyciem narzędzia \textit{Distance Accumulation} utworzono mapę odległości, na której każdemu pikselowi przypisano wartość odległości do najbliższego budynku mieszkalnego.

\vspace{5pt}

\begin{mintedbox}{python}
buildings_accumulation = arcpy.sa.DistanceAccumulation(in_source_data='residential_buildings')
\end{mintedbox}
\vspace{10pt}

Dla utworzonej warstwy dokonano określenia członkostwa z użyciem rosnącej funkcji liniowej.

\begin{mintedbox}{python}
residential_buildings = arcpy.sa.FuzzyMembership(buildings_accumulation, fuzzy_function="LINEAR 150 300")
\end{mintedbox}

\vspace{5pt}

\begin{enumerate}[label=•]
    \item wartości \( \leq 150 \) otrzymują wartość członkostwa 0 (nie spełniają kryterium)
    \item wartości \( \geq 300 \) otrzymują wartość członkostwa 1 (pełne spełnienie kryterium)
    \item wartości pomiędzy 150 a 300 otrzymują wartość członkostwa proporcjonalnie do ich odległości od 150
\end{enumerate}
\vspace{10pt}

Reklasyfikacji dokonano zgodnie z funkcją przedstawioną poniżej.
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{img/kryterium2-wykres-glowny.png}
    \caption{Reklasyfikacja dla kryterium 2.}
\end{figure}

Wynikiem analizy dla kryterium drugiego była poniższa mapa. 

Obszary czarne (nieprzydatne) tworzą 2 wzory, które koncentrują się w południowo-wschodniej oraz północno-zachodniej części terenu i rozgałęziają się w różne strony. Tereny o najwyższej przydatności (białe) występują w formie większych, zwartych obszarów, szczególnie w północnej, centralnej i zachodniej części mapy.
Widoczne są również szare strefy przejściowe, które reprezentują tereny o pośredniej przydatności.

\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/kryterium2-layout.jpg}
    \caption{Mapa przydatności dla kryterium 2.}
\end{figure}
\vspace{10pt}

\newpage
Poniżej zaprezentowano mapę przedstawiającą budynki mieszkalne na tle utworzonej mapy przydatności.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/kryterium2-budynki.jpg}
    \caption{Budynki mieszkalne na tle mapy przydatności}
\end{figure}
\vspace{10pt}

\subsection{Kryterium 3: pokrycie terenu}
Warstwą wejściową w kryterium trzecim była warstwa OT\_PTLZ\_A zawierająca tereny leśne i zadrzewione. 
\vspace{5pt}

\begin{mintedbox}{python}
ptlz = arcpy.management.Merge([f'{geobaza}\\PTLZ_A_0210', f'{geobaza}\\PTLZ_A_0212'], 'ptlz')
\end{mintedbox}
\vspace{10pt}

W celu obliczenia odległości komórek od terenów leśnych, wykorzystano funkcję \textit{Distance Accumulation}.

\begin{mintedbox}{python}
out_distance_accumulation_ptlz = arcpy.sa.DistanceAccumulation(in_source_data=ptlz)
\end{mintedbox}
\vspace{10pt}

Następnie określono poziom członkostwa przy użyciu \textit{Fuzzy Membership}.
\vspace{5pt}

\begin{mintedbox}{python}
lasy_fuzzy = arcpy.sa.FuzzyMembership(out_distance_accumulation_ptlz, fuzzy_function="LINEAR 15 100")
\end{mintedbox}
\vspace{10pt}

Dla powyższej funkcji:
\begin{enumerate}[label=•]
    \item wartości \( \leq 15 \) otrzymują wartość członkostwa 0 (nie spełniają kryterium)
    \item wartości \( \geq 100 \) otrzymują wartość członkostwa 1 (pełne spełnienie kryterium)
    \item wartości pomiędzy 15 a 100 otrzymują wartość członkostwa proporcjonalnie do ich odległości od 15
\end{enumerate}
\newpage

Reklasyfikacji dokonano zgodnie z funkcją przedstawioną poniżej.
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{img/kryterium3-wykres-glowny.png}
    \caption*{Reklasyfikacja dla kryterium 3.}
\end{figure}
\vspace{10pt}
Wynikiem analizy dla kryterium trzeciego była poniższa mapa.
Obszary nieprzydatne stanowią dużą część obszaru, rozciągając się na zachodzie, w centrum oraz wzdłuż granic gminy. Przydatne są głównie duże tereny na północy gminy oraz w południowo-wschodniej części.

\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/kryterium3-layout.jpg}
    \caption{Mapa przydatności dla kryterium 3.}
\end{figure}
\vspace{10pt}

Poniżej zaprezentowano mapę przedstawiającą lasy na tle utworzonej mapy przydatności. 

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/kryterium3-lasy.jpg}
    \caption{Lasy na tle mapy przydatności}
\end{figure}
\vspace{10pt}


\subsection{Kryterium 4: dostęp do dróg utwardzonych}
Drogi pobrano z bazy BDOT10k, wybierając obiekty o klasie OT\_SKDR\_L. 
\vspace{5pt}

\begin{mintedbox}{python}
drogi = arcpy.management.Merge([f'{geobaza}\\SKDR_L_0210', f'{geobaza}\\SKDR_L_0212'], 'drogi')
\end{mintedbox}
\vspace{10pt}

Ze wszystkich dróg wybrano jedynie te utwardzone, tj. takie, których materiał nawierzchni to beton, bruk, kostka kamienna, kostka prefabrykowana, masa bitumiczna lub płyty betonowe.
\vspace{5pt}

\begin{mintedbox}{python}
drogi_utwardzone = arcpy.analysis.Select(drogi, 'drogi_utwardzone', "MATE_NAWIE IN ('beton', 'bruk', 'kostka kamienna', 'kostka prefabrykowana', 'masa bitumiczna', 'płyty betonowe')")
\end{mintedbox}
\vspace{10pt}

Korzystając z narzędzia \textit{LineDensity} utworzono raster z gęstością dróg utwardzonych na km².
\vspace{5pt}

\begin{mintedbox}{python}
density = arcpy.sa.LineDensity(
    in_polyline_features=drogi_utwardzone,
    population_field=None,
    cell_size=5,
    search_radius=1000,
    area_unit_scale_factor="SQUARE_KILOMETERS",
)
\end{mintedbox}
\vspace{10pt}

Aby móc uzależnić funkcję reklasyfikacyjną od wartości rastra, liczona jest maksymalna wartość gęstości dróg w obszarze z użyciem narzędzia \textit{Calculate Statistics}.
\vspace{5pt}

\begin{mintedbox}{python}
arcpy.management.CalculateStatistics(density)
max_value = density.maximum
\end{mintedbox}
\vspace{10pt}
\newpage

Przy użyciu \textit{Rescale By Function} zostaje dokonana reklasyfikacja zgodnie z funkcją liniową.
\vspace{5pt}

\begin{mintedbox}{python}
kryterium_4 = arcpy.sa.RescaleByFunction(
    in_raster=density,
    transformation_function=f"LINEAR 0 {0.5 * max_value}",
    from_scale=0,
    to_scale=1   
\end{mintedbox}

\begin{enumerate}[label=•]
    \item wartości \( \geq 50\% \) maksymalnej wartości otrzymują wartość członkostwa 1 (pełne spełnienie kryterium)
    \item wartości pomiędzy 0 a 50\% otrzymują wartość członkostwa proporcjonalnie do ich odległości od 0
\end{enumerate}
\vspace{5pt}
\vspace{10pt}

Reklasyfikacji dokonano zgodnie z funkcją przedstawioną poniżej.
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{img/kryterium4-wykres-glowny.png}
    \caption{Reklasyfikacja dla kryterium 4.}
\end{figure}
\vspace{10pt}

Wynikiem analizy dla kryterium czwartego była poniższa mapa.

Obszary nieprzydatne stanowią stosunkowo małą część obszaru, głównie w zachodniej i północno-wschodniej części terenu. Całkowicie przydatny jest teren oznaczony dużą białą plamą.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/kryterium4-layout.jpg}
    \caption{Mapa przydatności dla kryterium 4.}
\end{figure}

Poniżej zaprezentowano mapę przedstawiającą drogi utwardzone na tle utworzonej wyżej mapy.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/kryterium4-drogi.jpg}
    \caption{Drogi utwardzone na tle mapy przydatności}
\end{figure}
\vspace{10pt}

\subsection{Kryterium 5: nachylenie stoków}
W celu realizacji kryterium pobrano kafelki NMT dla obszaru gminy. Połączono je wcześniej z użyciem narzędzia \textit{Mosaic To New Raster}. 
\vspace{5pt}

\begin{mintedbox}{python}
nmt = f'{geobaza}\\nmt'
\end{mintedbox}
\vspace{10pt}

Dla nowo powstałego rastra obliczono procentowe nachylenia stoków z użyciem narzędzia \textit{Slope} z zestawu \textit{3D Analyst}.
\vspace{5pt}

\begin{mintedbox}{python}
arcpy.ddd.Slope(nmt, "slope", "PERCENT_RISE", 1)
\end{mintedbox}
\vspace{10pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.55\textwidth]{img/kryterium5-stoki.jpg}
    \caption{Mapa nachyleń stoków powstała z użyciem narzędzie \textit{Slope}}
\end{figure}

Powstały raster zreklasyfikowano.
\vspace{5pt}

\begin{mintedbox}{python}
slope_fuzzy = arcpy.sa.FuzzyMembership("slope", fuzzy_function="LINEAR 10 7")
\end{mintedbox}

\begin{enumerate}[label=•]
    \item wartości \( \geq 10 \) otrzymują wartość członkostwa 0 (nie spełniają kryterium)
    \item wartości \( \leq 7 \) otrzymują wartość członkostwa 1 (pełne spełnienie kryterium)
    \item wartości pomiędzy 7 a 10 otrzymują wartość członkostwa proporcjonalnie do ich odległości od 10
\end{enumerate}
\vspace{10pt}

Reklasyfikacji dokonano zgodnie z funkcją przedstawioną poniżej.
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{img/kryterium5-wykres-glowny.png}
    \caption{Reklasyfikacja dla kryterium 5.}
\end{figure}
\vspace{10pt}

Wynikiem analizy dla kryterium piątego była poniższa mapa.
Obszary przydatne to duża północna, północno-wschodnia część gminy. Reszta obszaru, z wyjątkiem niewielkich przydatnych enklaw, ma niekorzystne uwarunkowania w zakresie tego kryterium.

\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/kryterium5-layout.jpg}
    \caption{Mapa przydatności dla kryterium 5.}
\end{figure}
\vspace{10pt}

\subsection{Kryterium 6: dostęp do światła słonecznego}

Do kryterium szóstego również wykorzystano NMT, a także narzędzie \textit{Aspect} z zestawu \textit{3D Analyst}.
\vspace{5pt}

\begin{mintedbox}{python}
aspect = arcpy.ddd.Aspect(nmt)
\end{mintedbox}
\vspace{10pt}

Efektem działania funkcji był poniższy raster, przedstawiający, na którą stronę świata wystawiony jest stok.
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/kryterium6-aspect.jpg}
    \caption{Mapa przedstawiająca wystawę słoneczną w stopniach}
\end{figure}
\vspace{10pt}

Przydatne w kontekście projektu są stoki południowo-zachodnie, południowe i południowo-wschodnie. 
Stworzono więc dwie funkcje reklasyfikacyjne.

\begin{mintedbox}{python}
increasing_aspect = arcpy.sa.FuzzyMembership(aspect, fuzzy_function="LINEAR 90 113")
decreasing_aspect = arcpy.sa.FuzzyMembership(aspect, fuzzy_function="LINEAR 270 248")
\end{mintedbox}

\vspace{10pt}

Dla funkcji rosnącej:

\begin{enumerate}[label=•]
    \item wartości \( \leq 90 \) otrzymują wartość członkostwa 0 (nie spełniają kryterium)
    \item wartości \( \geq 113 \) otrzymują wartość członkostwa 1 (pełne spełnienie kryterium)
    \item wartości pomiędzy 90 a 113 otrzymują wartość członkostwa proporcjonalnie do ich odległości od 90
\end{enumerate}
\vspace{10pt}

Dla funkcji malejącej:
\begin{enumerate}[label=•]
    \item wartości \( \geq 270 \) otrzymują wartość członkostwa 0 (nie spełniają kryterium)
    \item wartości \( \leq 248 \) otrzymują wartość członkostwa 1 (pełne spełnienie kryterium)
    \item wartości pomiędzy 248 a 270 otrzymują wartość członkostwa proporcjonalnie do ich odległości od 270
\end{enumerate}
\vspace{10pt}

\begin{figure}[H]
    \centering
    \begin{minipage}{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/kryterium6-wykres-pierwszy.png}
        \caption{Funkcja rosnąca}
    \end{minipage}
    \begin{minipage}{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/kryterium6-wykres-drugi.png}
        \caption{Funkcja malejąca}
    \end{minipage}
\end{figure}
\vspace{10pt}

Ostateczny wynik kryterium szóstego uzyskano po połączeniu obu warstw utworzonych wcześniej przy użyciu logiki rozmytej. Wykorzystano do tego narzędzie \textit{FuzzyOverlay}.
\vspace{5pt}

\begin{mintedbox}{python}
aspect_overlay = arcpy.sa.FuzzyOverlay([increasing_aspect, decreasing_aspect], 'AND')
\end{mintedbox}
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{img/kryterium6-wykres-glowny.png}
    \caption{Reklasyfikacja dla kryterium 6.}
\end{figure}
\vspace{10pt}

Kryterium wyłoniło tereny przydatne w północno-zachodniej, środkowej oraz południowo-wschodniej części obszaru. Znaczna część terenów charakteryzuje się niekorzystną wystawą słoneczną. Da się wyróżnić kilka płatów terenu o dobrych warunkach w różnych częściach gminy.
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{img/kryterium6-layout.jpg}
    \caption{Mapa przydatności dla kryterium 6.}
\end{figure}
\vspace{10pt}

\newpage
\subsection{Kryterium 7: dojazd do istotnych drogowych węzłów komunikacyjnych}
Warstwę wektorową zawierającą istotne drogowe węzły komunikacyjne utworzono manualnie na podstawie warstwy OT\_SKDR\_L z bazy BDOT10k. Przefiltrowano drogi, pozostawiając jedynie najważniejsze z nich - krajowe, wojewódzkie. Utworzono warstwę punktową, na której umieszczono kilka punktów w miejscach styku tych dróg. Następnie, korzystając z wtyczki \textit{QNEAT3 - QGIS Network Analysis Toolbox 3} oraz dostępnego w niej algorytmu \textit{Iso-Area as Interpolation (from Layer)}. Na podstawie sieci dróg, utworzyła ona raster zawierający dla każdej komórki odległość od węzła komunikacyjnego.
\vspace{5pt}

\begin{mintedbox}{python}
wezly = f'{geobaza}\\wezly_raster'
\end{mintedbox}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.65\textwidth]{img/kryterium7-wezly.jpg}
    \caption{Raster utworzony poprzez wtyczkę QGIS  \textit{QNEAT3}}
\end{figure}
\vspace{10pt}

Dla powyższego rastra obliczono maksymalną odległość od węzła w celu wykorzystania wartości dla funkcji w fuzzy membership.
\vspace{5pt}

\begin{mintedbox}{python}
wezly_max = float(arcpy.management.GetRasterProperties(wezly, "MAXIMUM")[0].replace(',', '.'))
\end{mintedbox}
\vspace{10pt}

Sprawdzono członkostwo na podstawie funkcji liniowej.
\vspace{5pt}

\begin{mintedbox}{python}
wezly_fuzzy = arcpy.sa.FuzzyMembership(wezly, fuzzy_function=f"LINEAR {wezly_max} {0.5 * wezly_max}")
\end{mintedbox}
\vspace{5pt}

\begin{enumerate}[label=•]
    \item wartości \( \leq \) połowy maksymalnej odległości od węzła otrzymują wartość członkostwa 1 (pełne spełnienie kryterium)
    \item wartości pomiędzy maksymalną odległością od węzła a połową maksymalnej odległości od węzła otrzymują wartość członkostwa proporcjonalnie do ich odległości od maksymalnej odległości od węzła
\end{enumerate}

\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{img/kryterium7-wykres-glowny.png}
    \caption{Reklasyfikacja dla kryterium 7.}
\end{figure}
\vspace{10pt}

Tereny położone w centralnej części rastra okazały się być najbardziej przydatne. Skraje najbardziej na południe oraz północny wschód mają najniższą przydatność.
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/kryterium7-layout.jpg}
    \caption{Mapa przydatności dla kryterium 7.}
\end{figure}
\vspace{10pt}

\newpage
\subsection{Ocena przydatności terenu}
Poniższy kod najpierw tworzy tabelę zawierającą wagi dla każdego z kryteriów, zmienne w zależności od wariantu. 
\vspace{5pt}

\begin{mintedbox}{python}
tabela_kryteriow = arcpy.sa.WSTable([[f'{geobaza}\\kryterium_1', "VALUE", waga_woda], [f'{geobaza}\\kryterium_2', "VALUE", waga_budynki], [f'{geobaza}\\kryterium_3', "VALUE", waga_lasy], [f'{geobaza}\\kryterium_4', "VALUE", waga_drogi], [f'{geobaza}\\kryterium_5', "VALUE", waga_wysokosc], [f'{geobaza}\\kryterium_6', "VALUE", waga_aspect], [f'{geobaza}\\kryterium_7', "VALUE", waga_wezly]])
\end{mintedbox}
\vspace{10pt}

Następnie tworzy sumę ważoną wszystkich z kryteriów.
\vspace{5pt}

\begin{mintedbox}{python}
weighted_sum = arcpy.sa.WeightedSum(tabela_kryteriow)
weighted_sum.save(f'{geobaza}\\{wariant}_suma_rozmyte')
\end{mintedbox}
\vspace{10pt}

Od teraz do końca sekcji przedstawiane będą podwójne wyniki - pierwszy wynik będzie dla przypadku, gdzie dla każdego kryterium przyjęto tę samą wagę, a drugi dla przypadku, gdzie wagi są różne. Poniżej przedstawiono przyjęte wagi w obu podejściach.
\begin{table}[ht]
    \begin{minipage}{0.48\textwidth}
        \centering
        \renewcommand{\arraystretch}{1.2}
        \begin{tabular}{|p{4cm}|p{1.4cm}|}
        \hline
        \textbf{Kryterium} & \textbf{Waga}\\
        \hline
        1 (odległość od rzek i zbiorników wodnych) & 0.142857\\
        \hline
        2 (odległość od budynków mieszkalnych) & 0.142857\\
        \hline
        3 (pokrycie terenu) & 0.142857\\
        \hline
        4 (dostęp do dróg utwardzonych) & 0.142857\\
        \hline
        5 (nachylenie stoków) & 0.142857\\    
        \hline
        6 (dostęp światła słonecznego) & 0.142857\\
        \hline
        7 (dobry dojazd do istotnych węzłów komunikacyjnych) & 0.142857\\
        \hline
        \end{tabular}
        \caption{Tabela z równymi wagami dla kryteriów}
        \label{tab:bdot_costs_equal}
    \end{minipage}
    \hfill
    \begin{minipage}{0.48\textwidth}
        \centering
        \renewcommand{\arraystretch}{1.2}
        \begin{tabular}{|p{4cm}|p{1cm}|}
        \hline
        \textbf{Kryterium} & \textbf{Waga}\\
        \hline
        1 (odległość od rzek i zbiorników wodnych) & 0.10\\
        \hline
        2 (odległość od budynków mieszkalnych) & 0.15\\
        \hline
        3 (pokrycie terenu) & 0.20\\
        \hline
        4 (dostęp do dróg utwardzonych) & 0.10\\
        \hline
        5 (nachylenie stoków) & 0.15\\    
        \hline
        6 (dostęp światła słonecznego) & 0.25\\
        \hline
        7 (dobry dojazd do istotnych węzłów komunikacyjnych) & 0.05\\
        \hline
        \end{tabular}
        \caption{Tabela z różnymi wagami dla kryteriów}
        \label{tab:bdot_costs_different}
    \end{minipage}
\end{table}


\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/rozmyte-layout.jpg}
        \caption{Suma kryteriów rozmytych - wagi równe}
        \label{fig:rozmyte-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-rozmyte-layout.jpg}
        \caption{Suma kryteriów rozmytych - wagi różne}
        \label{fig:rozmyte-rozne}
    \end{minipage}
\end{figure}

\vspace{5pt}

Później brane są pod uwagę kryteria ostre, tj. 100-metrowa strefa ochronna od wód, 150-metrowa odległość od budynków mieszkalnych oraz 15-metrowa odległość od lasów. W funkcji \textit{FuzzyOverlay} wybrano parametr \textit{AND}, dzięki czemu zostaje utworzony raster, który przyjmuje najniższą możliwą wartość dla komórki. 
\vspace{5pt}

\begin{mintedbox}{python}
kryteria_ostre = arcpy.sa.FuzzyOverlay([woda_rosnaca, f"{geobaza}\\kryterium_2", f"{geobaza}\\kryterium_3"], 'AND')
kryteria_ostre.save(f'{geobaza}\\kryteria_ostre')
\end{mintedbox}
\vspace{10pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.65\textwidth]{img/ostre-layout.jpg}
    \caption{Suma kryteriów ostrych}
\end{figure}
\vspace{10pt}

Następnie zostaje utworzony iloczyn kryteriów ostrych i rozmytych. W ten sposób eliminowane z dalszych analiz są komórki wykluczone przez któreś z kryteriów ostrych.
\vspace{5pt}

\begin{mintedbox}{python}
iloczyn = arcpy.sa.FuzzyOverlay([kryteria_ostre, weighted_sum], 'AND')
iloczyn.save(f'{geobaza}\\{wariant}_wynik')
\end{mintedbox}
\vspace{10pt}

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/wynik.jpg}
        \caption{Wynik łączenia kryteriów ostrych i rozmytych - wagi równe}
        \label{fig:wynik-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-wynik.jpg}
        \caption{Wynik łączenia kryteriów ostrych i rozmytych - wagi różne}
        \label{fig:wynik-rozne}
    \end{minipage}
\end{figure}

\vspace{10pt}

Przed reklasyfikacją, obliczana jest maksymalna przydatność na obszarze.
\vspace{5pt}

\begin{mintedbox}{python}
arcpy.management.CalculateStatistics(iloczyn)
max_przydatnosc = iloczyn.maximum
\end{mintedbox}
\vspace{10pt}

Utworzony przez połączenie kryteriów ostrych i rozmytych raster reklasyfikujemy, przyporządkowując komórkom o przydatności powyżej określonego progu przydatności wartość 1, a pozostałym komórkom - wartość 0.
\vspace{5pt}

\begin{mintedbox}{python}
wynik_reclassified = arcpy.sa.Reclassify(iloczyn, "VALUE", arcpy.sa.RemapRange([[0, prog_przydatnosci * max_przydatnosc, 0], [prog_przydatnosci * max_przydatnosc, 1, 1]]))
wynik_reclassified.save(f'{geobaza}\\{wariant}_wynik_reclassified')
\end{mintedbox}
\vspace{5pt}

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/wynik-po-reklasyfikacji.jpg}
        \caption{Wynik łączenia kryteriów ostrych i rozmytych po reklasyfikacji - wagi równe}
        \label{fig:wynik-reklasyfikacja-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-wynik-po-reklasyfikacji.jpg}
        \caption{Wynik łączenia kryteriów ostrych i rozmytych po reklasyfikacji - wagi różne}
        \label{fig:wynik-reklasyfikacja-rozne}
    \end{minipage}
\end{figure}

\newpage

\subsection{Wybór przydatnych działek}
W pierwszym kroku w tym etapie zamieniamy rastrową warstwę z przydatnością terenu na warstwę poligonową.
\vspace{5pt}

\begin{mintedbox}{python}
arcpy.conversion.RasterToPolygon(f'{geobaza}\\{wariant}_wynik_reclassified', 'poligon_przydatnosci', "NO_SIMPLIFY", "VALUE")
\end{mintedbox}
\vspace{10pt}

Aby wybrać jedynie te poligony, które są terenami przydatnymi, korzystami z narzędzia \textit{Select Layer By Attribute}, wybierając obiekty o wartości 1 w polu \textit{gridcode}.
\vspace{5pt}

\begin{mintedbox}{python}
arcpy.management.MakeFeatureLayer('poligon_przydatnosci', "poligon_przydatnosci_layer")
arcpy.management.SelectLayerByAttribute("poligon_przydatnosci_layer", "NEW_SELECTION", "gridcode = 1")
\end{mintedbox}
\vspace{10pt}

W następnym kroku należało wykorzystać już warstwę z działkami. Warstwę działek pobrano poprzez usługę WFS odpowiedniej ewidencji gruntów i budynków.
\vspace{5pt}

\begin{mintedbox}{python}
dzialki = f'{geobaza}\\dzialki'
\end{mintedbox}
\vspace{10pt}

Następnie z użyciem funkcji \textit{Summarize Within}, dla każdej działki jest liczona powierzchnia, jaką stanowią dla niej poligony przydatne. 

\vspace{5pt}

\begin{mintedbox}{python}
arcpy.analysis.SummarizeWithin(
    in_polygons=dzialki,
    in_sum_features=f"{geobaza}\\{wariant}_poligon_przydatnosci",
    out_feature_class=f'{geobaza}\\{wariant}_summarized_within',
    keep_all_polygons="ONLY_INTERSECTING",
    shape_unit="SQUAREMETERS",
    add_group_percent="NO_PERCENT",
)    
\end{mintedbox}
\vspace{10pt}

Dla każdej działki liczone jest pole \textit{pow\_przyd} informujące o tym, jaki procent działki stanowi teren przydatny, na podstawie pola \textit{sum\_Area\_squaremeters} utworzonego w poprzednim kroku. Wykorzystano do tego narzędzie \textit{Calculate Field}.
\vspace{5pt}

\begin{mintedbox}{python}
arcpy.management.CalculateField(
    in_table=f'{geobaza}\\{wariant}_summarized_within',
    field="pow_przyd",
    expression="100*!sum_Area_squaremeters!/!Shape_Area!",
    expression_type="PYTHON3",
    code_block="",
    field_type="FLOAT"
)
\end{mintedbox}
\vspace{10pt}

Utworzone pole jest wykorzystane w narzędziu \textit{Select Layer By Attribute}, gdzie wybierane są działki o procentowej powierzchni przydatnej wyższej od określonego progu.
\vspace{5pt}

\begin{mintedbox}{python}
dzialki_przydatne_powyzej_progu = arcpy.management.SelectLayerByAttribute(f'{geobaza}\\{wariant}_summarized_within', "NEW_SELECTION", f"pow_przyd >= {prog_przydatnosci}")
arcpy.management.CopyFeatures(dzialki_przydatne_powyzej_progu, f"{geobaza}\\{wariant}_dzialki_przydatne_powyzej")
\end{mintedbox}
\vspace{10pt}

Zgodnie z założeniami projektu, przydatne działki, które ze sobą sąsiadują, są łączone w jedną grupę przy użyciu narzędzi \textit{Dissolve}.
\vspace{5pt}

\begin{mintedbox}{python}
arcpy.management.Dissolve(
in_features=f"{geobaza}\\{wariant}_dzialki_przydatne_powyzej",
out_feature_class=f"{geobaza}\\{wariant}_dzialki_przydatne_powyzej_dissolve",
multi_part="SINGLE_PART",
unsplit_lines="DISSOLVE_LINES",
concatenation_separator=""
)
\end{mintedbox}
\vspace{10pt}

W ostatnim kroku wybierane są działki lub grupy działek o łącznej powierzchni powyżej 2ha (20 000 m2).

\begin{mintedbox}{python}
arcpy.management.MakeFeatureLayer(f"{geobaza}\\{wariant}_dzialki_przydatne_powyzej_dissolve", f"{geobaza}\\{wariant}_dzialki_przydatne_powyzej_dissolve_layer")
arcpy.management.SelectLayerByAttribute(f"{geobaza}\\{wariant}_dzialki_przydatne_powyzej_dissolve_layer", "NEW_SELECTION", "Shape_Area >= 20000")
arcpy.management.CopyFeatures(f"{geobaza}\\{wariant}_dzialki_przydatne_powyzej_dissolve_layer", f"{geobaza}\\{wariant}_grupy_dzialek_przydatne_powyzej_{prog_przydatnosci}")
\end{mintedbox}

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/przydatne-dzialki.jpg}
        \caption{Mapa przedstawiająca przydatne działki - wagi równe}
        \label{fig:przydatne-dzialki-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-przydatne-dzialki.jpg}
        \caption{Mapa przedstawiająca przydatne działki - wagi różne}
        \label{fig:przydatne-dzialki-rozne}
    \end{minipage}
\end{figure}


\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/dzialki-przydatne-ortofoto.jpg}
        \caption{Mapa przedstawiająca przydatne działki na ortofotomapie - wagi równe}
        \label{fig:dzialki-ortofoto-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-dzialki-przydatne-ortofoto.jpg}
        \caption{Mapa przedstawiająca przydatne działki na ortofotomapie - wagi różne}
        \label{fig:dzialki-ortofoto-rozne}
    \end{minipage}
\end{figure}

\subsection{Koszt przyłącza do sieci SN}
Przed rozpoczęciem analiz należało stworzyć tzw. mapę kosztów względnych(jednostkowych), która przedstawia faktyczną lub umowną wartość kosztu zbudowania
przyłącza przez dany obszar. Dla mapy kosztów względnych w postaci rastrowej, będzie to względny koszt budowy przyłącza na obszarze o powierzchni odpowiadającej rozmiarowi
piksela. W ćwiczeniu przyjęto, że koszt = 1 jest odniesiony do obszarów rolniczych (najmniejszy koszt prac ziemnych / budowlanych dla 1 piksela). Koszty względne dla innych obszarów są obliczane jako wielokrotność kosztów dla terenów rolniczych. Przypisane koszty dla wszystkich kategorii użytkowania terenu dla doprowadzenia do
farmy przyłącza przedstawia tabela.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{img/tabela_kosztow_wzglednych.png}
    \caption*{}
\end{figure}

\vspace{-30pt}

\begin{table}[ht]
    \centering % Wyśrodkowanie tabeli
    \renewcommand{\arraystretch}{1.2} % Zwiększenie odstępów między wierszami
    % \begin{tabular}{|p{2cm}|p{4.5cm}|p{2cm}|p{3cm}|p{2cm}|}
    % \hline
    % \textbf{Kod klasy obiektów BDOT} & \textbf{Nazwa klasy obiektów BDOT} & \textbf{X\_kod} & \textbf{Typ obiektu} & \textbf{Koszt względny} \\
    % \hline
    % PTWP & woda powierzchniowa & PTWP01 & woda morska & 0 $\rightarrow$ NoData \\ \cline{3-5}
    % & & PTWP02 & woda płynąca & 200 \\ \cline{3-5}
    % & & PTWP03 & woda stojąca & 0 $\rightarrow$ NoData \\ 
    % \hline
    % PTZB & zabudowa & PTZB02 & jednorodzinna & 100 \\ \cline{3-5}
    % & & PTZB01 & wielorodzinna & 200 \\ \cline{3-5}
    % & & PTZB05 & pozostała \newline zabudowa & 50 \\ \cline{3-5}
    % & & PTZB04 & handlowo-usługowa & 200 \\ \cline{3-5}
    % & & PTZB03 & przemysłowo-składowa & 200 \\ 
    % \hline
    % PTLZ & teren leśny i zadrzewiony & PTLZ01 & las & 100 \\ \cline{3-5}
    % & & PTLZ02 & zagajnik & 50 \\ \cline{3-5}
    % & & PTLZ03 & zadrzewienie & 50 \\ 
    % \hline
    % PTRK & roślinność krzewiasta & PTRK01 & kępy krzewów & 20 \\ \cline{3-5}
    % & & PTRK02 & krzewy & 15 \\ 
    % \hline
    % PTUT & uprawa trwała & PTUT03 & sad & 100 \\ \cline{3-5}
    % & & PTUT02 & plantacja & 90 \\ \cline{3-5}
    % & & PTUT04, PTUT05 & inne & 20 \\ \cline{3-5}
    % & & PTUT01 & ogród działkowy & 0 $\rightarrow$ NoData \\ 
    % \hline
    % PTTR & roślinność trawiasta i uprawa rolna & PTTR02 & grunt orny & 1 \\ \cline{3-5}
    % & & PTTR01 & roślinność \newline trawiasta & 20 \\ 
    % \hline
    % PTKM & teren pod drogami kołowymi, szynowymi i lotniskowymi & PTKM02 & torowisko & 200 \\ \cline{3-5}
    % & & PTKM01 & droga kołowa & 200 \\ \cline{3-5}
    % & & PTKM03 & teren pod drogą \newline kołową \newline i torowiskiem & 200 \\ \cline{3-5}
    % & & PTKM04 & teren pod drogą \newline lotniskową & 0 $\rightarrow$ NoData \\ 
    % \hline
    % PTGN & grunt nieużytkowany & PTGN01, PTGN02, PTGN03, PTGN04 & - & 1 \\ 
    % \hline
    % PTPL & plac & PTPL01 & - & 50 \\ 
    % \hline
    % PTSO & składowisko odpadów & PTSO01, PTSO02 & - & 0 $\rightarrow$ NoData \\ 
    % \hline
    % PTWZ & wyrobisko i zwałowisko & PTWZ01, PTWZ02 & - & 0 $\rightarrow$ NoData \\ 
    % \hline
    % PTNZ & pozostały teren niezabudowany & PTNZ01, PTNZ02 & - & 150 \\ 
    % \hline
    % \end{tabular}
    \caption{Tabela kosztów względnych dla różnych typów obiektów BDOT.}
    \label{tab:bdot_costs}
\end{table}
\vspace{10pt}

Aby uzyskać jedną warstwę z informacją o pokryciu terenu i móc podporządkować każdemu z nich odpowiedni koszt, połączono wszystkie warstwy pokrycia terenu z BDOT10k.
\vspace{5pt}

\begin{mintedbox}{python}
pt_merged = f'{geobaza}\\PT_merged'
\end{mintedbox}

W powstałej warstwie utworzono pole \textit{cost} i przyporządkowano mu odpowiednią wartość w zależności od typu obiektu. Wykorzystano do tego atrybut \textit{x\_kod}, który znajdował się w każdej z warstw i jednoznacznie identyfikował typ pokrycia terenu.
\vspace{5pt}

\begin{mintedbox}{python}
pt_merged_layer = "pt_merged_layer"
arcpy.management.MakeFeatureLayer(pt_merged, pt_merged_layer)
arcpy.management.AddField(pt_merged_layer, "cost", "FLOAT")
arcpy.management.CalculateField(
    in_table=pt_merged_layer,
    field="cost",
    expression="costs.get(!x_kod!, 0)",
    expression_type="PYTHON3",
    code_block="""costs = {
    "PTWP01": 0, 
    "PTWP02": 200,
    "PTWP03": 0,
    "PTZB02": 100,
    "PTZB01": 200,
    "PTZB05": 50,
    "PTZB04": 200,
    "PTZB03": 200,
    "PTLZ01": 100,
    "PTLZ02": 50,
    "PTLZ03": 50,
    "PTRK01": 15,
    "PTRK02": 15,
    "PTUT03": 100,
    "PTUT02": 90,
    "PTUT04": 20,
    "PTUT05": 20,
    "PTUT01": 0,
    "PTTR02": 1,
    "PTTR01": 20,
    "PTKM02": 200,
    "PTKM01": 100,
    "PTKM03": 200,
    "PTKM04": 0,
    "PTGN01": 1,
    "PTGN02": 1,
    "PTGN03": 1,
    "PTGN04": 1,
    "PTPL01": 50,
    "PTSO01": 0,
    "PTSO02": 0,
    "PTWZ01": 0,
    "PTWZ02": 0,
    "PTNZ01": 150,
    "PTNZ02": 150
    }"""
)
\end{mintedbox}
\vspace{10pt}

Warstwę poligonową z przyporządkowanymi kosztami zamieniono na raster funkcją \textit{Polygon To Raster}.
\vspace{5pt}

\begin{mintedbox}{python}
out_cost = arcpy.conversion.PolygonToRaster(
    in_features=pt_merged_layer,
    value_field="cost",
    out_rasterdataset=f"{geobaza}\\{wariant}_cost_raster",
    cell_assignment="CELL_CENTER",
    cellsize=5
)
\end{mintedbox}
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/cost-raster.jpg}
    \caption{Mapa kosztów względnych}
\end{figure}
\vspace{10pt}

Wykorzystując funkcję \textit{Cost Distance} utworzono mapę kosztów skumulowanych (cost map) oraz mapę kierunków (backlink raster).
\vspace{5pt}

\begin{mintedbox}{python}
out_distance = arcpy.sa.CostDistance(
    in_source_data=f"{geobaza}\\{wariant}_dzialki_przydatne_powyzej_{prog_przydatnosci}",
    in_cost_raster=f"{geobaza}\\{wariant}_cost_raster",
    maximum_distance=None,
    out_backlink_raster=f"{geobaza}\\{wariant}_cost_backlink",
    source_cost_multiplier=None,
    source_start_cost=None,
    source_resistance_rate=None,
    source_capacity=None,
    source_direction=""
)
out_distance.save(f"{geobaza}\\{wariant}_cost_distance")
\end{mintedbox}
\vspace{5pt}

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/cost-backlink.jpg}
        \caption{Mapa kierunków (backlink) - równe wagi}
        \label{fig:backlink-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-cost-backlink.jpg}
        \caption{Mapa kierunków (backlink) - różne wagi}
        \label{fig:backlink-rozne}
    \end{minipage}
\end{figure}
\vspace{10pt}

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/cost-distance.jpg}
        \caption{Mapa kosztów skumulowanych - równe wagi}
        \label{fig:cost-distance-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-cost-distance.jpg}
        \caption{Mapa kosztów skumulowanych - różne wagi}
        \label{fig:cost-distance-rozne}
    \end{minipage}
\end{figure}
\vspace{10pt}

Powyższe rastry wykorzystano w narzędziu \textit{Cost Path} i utworzono ścieżkę przyłącza do linii elektroenergetycznej o najniższym koszcie.
\vspace{5pt}

\begin{mintedbox}{python}
out_path = arcpy.sa.CostPath(
    in_destination_data=linie_elektroenergetyczne,
    in_cost_distance_raster=f"{geobaza}\\{wariant}_cost_distance",
    in_cost_backlink_raster=f"{geobaza}\\{wariant}_cost_backlink",
    path_type="BEST_SINGLE",
    force_flow_direction_convention="INPUT_RANGE"
)
out_path.save(f"{geobaza}\\{wariant}_cost_path")
\end{mintedbox}
\vspace{10pt}

Dokonano konwersji ścieżki z postaci rastrowej na postać wektorową narzędziem \textit{Raster to Polyline}.

\begin{mintedbox}{python}
path_vector = arcpy.conversion.RasterToPolyline(in_raster=out_path, out_polyline_features=f"{geobaza}\\{wariant}_cost_path_vector")
\end{mintedbox}
\vspace{10pt}

W przypadku wersji z równymi wagami, linia elektroenergetyczna przechodzi przez jedną z wytypowanych grup działek. W związku z tym żadna ścieżka przyłącza nie została utworzona. 
\vspace{5pt}

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/dzialki-linie.jpg}
        \caption{Mapa przedstawiająca przydatne działki oraz linie elektroenergetyczne - równe wagi}
        \label{fig:dzialki-linie-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-dzialki-linie.jpg}
        \caption{Mapa przedstawiająca przydatne działki oraz linie elektroenergetyczne - różne wagi}
        \label{fig:dzialki-linie-rozne}
    \end{minipage}
\end{figure}
\vspace{10pt}

Poniżej znajduje się wersja przyłącza utworzona dla wersji z różnymi wagami dla kryteriów.
\vspace{5pt}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\textwidth]{img/roznewagi-path-raster.jpg}
    \caption{Mapa przedstawiająca utworzoną ścieżkę w postaci rastrowej - różne wagi}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\textwidth]{img/roznewagi-path-vector.jpg}
    \caption{Mapa przedstawiająca utworzoną ścieżkę w postaci wektorowej - różne wagi}
\end{figure}
\vspace{10pt}

Ostatecznie wybrano działkę przydatną o najmniejszym koszcie przyłącza.
\vspace{5pt}

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/wybrana-dzialka.jpg}
        \caption{Mapa przedstawiająca wybraną działkę - równe wagi}
        \label{fig:dzialki-linie-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-wybrana-dzialka.jpg}
        \caption{Mapa przedstawiająca wybraną działkę - różne wagi}
        \label{fig:dzialki-linie-rowne}
    \end{minipage}
\end{figure}
\newpage

\section{Test modelu na danych z innego obszaru}
\subsection{Opis obszaru}
Stworzony model należało przetestować na innym obszarze. Wybrano do tego celu gminę Pleśna - wiejską gminę w powiecie tarnowskim w województwie małopolskim.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/plesna-polozenie.jpg}
    \caption{Położenie gminy na mapie województwa małopolskiego}
\end{figure}

\subsection{Kryterium 1: odległość od rzek i zbiorników wodnych}
W gminie występuje duża gęstość rzek i zbiorników wodnych, lecz ze względu na łagodnie postawione granice dla tego kryterium, duża część obszaru gminy cechuje się dużą przydatnością.

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium1-layout.jpg}
        \caption{Mapa przydatności dla kryterium 1.}
        \label{fig:kryterium1-layout}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium1-woda.jpg}
        \caption{Mapa przydatności dla kryterium 1. zawierająca rzeki oraz zbiorniki wodne}
        \label{fig:kryterium1-woda}
    \end{minipage}
\end{figure}


\subsection{Kryterium 2: odległość od budynków mieszkalnych}
Jak widać poniżej, w gminie znajduje się wiele budynków mieszkalnych, rozmieszczonych mniej więcj równomiernie po całym jej obszarze. Duża część terenu zostaje już na tym etapie wyeliminowana ze względu na obecność kryterium ostrego odległości powyżej 150 metrów od budynków mieszkalnych.

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium2-layout.jpg}
        \caption{Mapa przydatności dla kryterium 2.}
        \label{fig:kryterium2-layout}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium2-budynki.jpg}
        \caption{Mapa przydatności dla kryterium 2. zawierająca budynki mieszkalne}
        \label{fig:kryterium2-budynki}
    \end{minipage}
\end{figure}


\subsection{Kryterium 3: pokrycie terenu}
Duża część obszaru, która dla kryterium 2. przyjęła dużą przydatność, tutaj zostaje całkowicie wyeliminowana ze względu na pojawienie się tam terenów leśnych.

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium3-layout.jpg}
        \caption{Mapa przydatności dla kryterium 3.}
        \label{fig:kryterium3-layout}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium3-lasy.jpg}
        \caption{Mapa przydatności dla kryterium 3. zawierająca lasy}
        \label{fig:kryterium3-lasy}
    \end{minipage}
\end{figure}


\subsection{Kryterium 4: dostęp do dróg utwardzonych}
Stosunkowo duża część obszaru, w porównaniu do poprzednich kryteriów, cechuje się dużą przydatnością dla tego kryterium.

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium4-layout.jpg}
        \caption{Mapa przydatności dla kryterium 4.}
        \label{fig:kryterium4-layout}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium4-drogi.jpg}
        \caption{Mapa przydatności dla kryterium 4. zawierająca drogi utwardzone}
        \label{fig:kryterium4-drogi}
    \end{minipage}
\end{figure}


\subsection{Kryterium 5: nachylenie stoków}
Gmina ta również jest gminą o stosunkowo dużych nachyleniach stoków. Lecz istnieją również w niej tereny o niższych stokach, na zachodzie oraz północnym wschodzie.

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium5-layout.jpg}
        \caption{Mapa przydatności dla kryterium 5.}
        \label{fig:kryterium5-layout}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium5-stoki.jpg}
        \caption{Mapa nachyleń stoków wykorzystana podczas sprawdzania kryterium 5.}
        \label{fig:kryterium5-stoki}
    \end{minipage}
\end{figure}


\subsection{Kryterium 6: dostęp do światła słonecznego}
Pod względem tego kryterium gmina wydaje się w dużej części korzystnie uwarunkowana.

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium6-layout.jpg}
        \caption{Mapa przydatności dla kryterium 6.}
        \label{fig:kryterium6-layout}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium6-aspect.jpg}
        \caption{Mapa przydatności dla kryterium 6. zawierająca stopień wystawy słonecznej}
        \label{fig:kryterium6-aspect}
    \end{minipage}
\end{figure}


\subsection{Kryterium 7: dojazd do istotnych drogowych węzłów komunikacyjnych}

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium7-layout.jpg}
        \caption{Mapa przydatności dla kryterium 7.}
        \label{fig:kryterium7-layout}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-kryterium7-wezly.jpg}
        \caption{Mapa odległości od węzłów}
        \label{fig:kryterium7-wezly}
    \end{minipage}
\end{figure}

\subsection{Ocena przydatności terenu}
\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-rozmyte-layout.jpg}
        \caption{Suma kryteriów rozmytych - wagi równe}
        \label{fig:rozmyte-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-plesna-rozmyte-layout.jpg}
        \caption{Suma kryteriów rozmytych - wagi różne}
        \label{fig:rozmyte-rozne}
    \end{minipage}
\end{figure}

Ogromna część obszaru gminy jest zupełnie nieprzydatna do inwestycji ze względu na bliskość budynków mieszkalnych, lasów czy wody. Elementy te wzajemnie się uzupełniają i jeżeli na terenie nie ma budynków mieszkalnych, to istnieje tam las, albo przepływa tam rzeka. W wyniku tego niemal cała gmina jest czarną plamą oznaczającą zerową przydatność.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/plesna-ostre-layout.jpg}
    \caption{Suma kryteriów ostrych}
\end{figure}

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-wynik.jpg}
        \caption{Wynik łączenia kryteriów ostrych i rozmytych - wagi równe}
        \label{fig:wynik-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-plesna-wynik.jpg}
        \caption{Wynik łączenia kryteriów ostrych i rozmytych - wagi różne}
        \label{fig:wynik-rozne}
    \end{minipage}
\end{figure}
Niewielkie obszary przydatne, jakie pozostały po połączeniu kryteriów, znajdują się głównie w zachodniej części gminy Pleśna.

\begin{figure}[H]
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/plesna-wynik-po-reklasyfikacji.jpg}
        \caption{Wynik łączenia kryteriów ostrych i rozmytych po reklasyfikacji - wagi równe}
        \label{fig:wynik-reklasyfikacja-rowne}
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{img/roznewagi-plesna-wynik-po-reklasyfikacji.jpg}
        \caption{Wynik łączenia kryteriów ostrych i rozmytych po reklasyfikacji - wagi różne}
        \label{fig:wynik-reklasyfikacja-rozne}
    \end{minipage}
\end{figure}
\subsection{Wybór przydatnych działek}

Pomimo nikłej obecności terenów przydatnych pod tę inwestycję w gminie, udało się wyłonić te same 2 grupy działek dla obu wariantów.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/plesna-przydatne-dzialki.jpg}
    \caption{Mapa przedstawiająca przydatne działki}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/plesna-dzialki-przydatne-ortofoto.jpg}
    \caption{Mapa przedstawiająca przydatne działki na ortofotomapie}
\end{figure}

\subsection{Przyłącze do sieci SN}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/plesna-cost-raster.jpg}
    \caption{Mapa kosztów względnych}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/plesna-cost-backlink.jpg}
    \caption{Mapa kierunków (backlink)}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/plesna-cost-distance.jpg}
    \caption{Mapa kosztów skumulowanych}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/plesna-dzialki-linie.jpg}
    \caption{Mapa przedstawiająca przydatne działki oraz linie elektroenergetyczne}
\end{figure}

Przez jedną z wytypowanych grup działek przechodzi już linia elektroenergetyczna, w związku z czym ścieżka przyłącza nie została utworzona.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{img/plesna-braksciezki.jpg}
    \caption{Mapa przedstawiająca linie elektroenergetyczne przechodzące przez jedną z grup działek}
\end{figure}


\end{document}